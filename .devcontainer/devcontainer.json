{
  "name": "Python DevContainer",
  "build": {
    "dockerfile": "Dockerfile"
  },

  // Use the 'vscode' user (common in devcontainers). If your image uses a different user,
  // either set it here or adjust /home/<user> paths below.
  "remoteUser": "vscode",

  "customizations": {
    "vscode": {
      "settings": {
        // Optional: have VS Code use the container's Git UI nicely
        "git.autofetch": true,
        "git.enableSmartCommit": true,
        "git.confirmSync": false,
        "git.pruneOnFetch": true
      },
      "extensions": ["ms-python.python", "ms-toolsai.jupyter"]
    }
  },

  // Mount ONLY the key files (not your macOS ~/.ssh/config, which contains macOS-only options)
  "mounts": [
    "source=${localEnv:HOME}/.ssh/id_ed25519_personal,target=/home/vscode/.ssh/id_ed25519_personal,type=bind,readonly",
    "source=${localEnv:HOME}/.ssh/id_ed25519_personal.pub,target=/home/vscode/.ssh/id_ed25519_personal.pub,type=bind,readonly"
  ],

  // Ensure ports from the app (if any) are forwarded; SSH to GitHub uses outbound 443 so no need here
  "forwardPorts": [],

  // Install Python deps after container is created (kept from your config)
  "postCreateCommand": "pip install -r requirements.txt",

  // After the container starts, fix permissions, write a Linux-safe SSH config (port 443),
  // and set your personal Git identity inside the container.
  "postStartCommand": [
    "mkdir -p ~/.ssh && chmod 700 ~/.ssh",
    // create a clean SSH config that works in Linux (no 'UseKeychain')
    "bash -lc 'cat > ~/.ssh/config <<\"EOF\"\nHost github.com-personal\n  HostName ssh.github.com\n  Port 443\n  User git\n  IdentityFile ~/.ssh/id_ed25519_personal\n  IdentitiesOnly yes\nEOF'",
    "chmod 600 ~/.ssh/config",
    // personal Git identity (global inside the container)
    "git config --global user.name \"ShubhankarD\"",
    "git config --global user.email \"ShubhankarDash@outlook.com\""
  ]
}
